// @ts-nocheck
import supabase from"@/lib/supabase";async function getUid(){const{data:e,error:t}=await supabase.auth.getUser();if(t)throw t;const a=e?.user?.id;if(!a)throw new Error("Not signed in");return a}function localTzOffsetMinutes(){return-(new Date).getTimezoneOffset()}export const Migraines={async list(e=500){const t=await getUid(),{data:a,error:r}=await supabase.from("migraine_episodes").select("*").eq("user_id",t).order("date",{ascending:!1}).limit(e);if(r)throw r;return a||[]},async create(e){const t={user_id:await getUid(),date:new Date(e.date).toISOString(),pain:Number(e.pain),symptoms:e.symptoms||[],triggers:e.triggers||[],glucose_at_start:e.glucose_at_start??null,note:e.note||null,timezone_offset_min:localTzOffsetMinutes()},{data:a,error:r}=await supabase.from("migraine_episodes").insert(t).select().single();if(r)throw r;return a}};export const Glucose={async list(e=1e3){const t=await getUid(),{data:a,error:r}=await supabase.from("glucose_readings").select("*").eq("user_id",t).order("device_time",{ascending:!1}).limit(e);if(r)throw r;return a||[]},async create(e){const t={user_id:await getUid(),device_time:new Date(e.device_time).toISOString(),value_mgdl:null!=e.value_mgdl?Number(e.value_mgdl):null,trend:e.trend||null,source:e.source||"manual",note:e.note||null,reading_type:e.reading_type||null,timezone_offset_min:localTzOffsetMinutes()},{data:a,error:r}=await supabase.from("glucose_readings").insert(t).select().single();if(r)throw r;return a}};export const Sleep={async list(e=365){const t=await getUid(),{data:a,error:r}=await supabase.from("sleep_data").select("*").eq("user_id",t).order("start_time",{ascending:!1}).limit(e);if(r)throw r;return a||[]},async create(e){const t={user_id:await getUid(),start_time:new Date(e.start_time).toISOString(),end_time:new Date(e.end_time).toISOString(),efficiency:null!=e.efficiency?Number(e.efficiency):null,stages:e.stages||null,source:e.source||"manual",note:e.note||null,timezone_offset_min:localTzOffsetMinutes()},{data:a,error:r}=await supabase.from("sleep_data").insert(t).select().single();if(r)throw r;return a}};