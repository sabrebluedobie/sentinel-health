// @ts-nocheck
import fetch from"node-fetch";import{createClient}from"@supabase/supabase-js";const supabase=createClient(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY);export default async function handler(e,t){const{uid:n,url:s,token:a}=e.query,r=a?{"api-secret":a}:{},i=await fetch(`${s.replace(/\/$/,"")}/api/v1/entries.json?count=100`,{headers:r}),o=(await i.json()).map((e=>({user_id:n,device_time:e.dateString,value_mgdl:e.sgv,trend:e.direction||null,source:"nightscout",note:null,reading_type:null,timezone_offset_min:null})));o.length&&await supabase.from("glucose_readings").insert(o),t.status(200).json({inserted:o.length})}