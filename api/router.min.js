// @ts-nocheck
import nsSave from"../server/cgm/nightscout/save.js";import nsSync from"../server/cgm/nightscout/sync.js";import nsTest from"../server/cgm/nightscout/test.js";function setCORS(t){t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET,POST,PUT,PATCH,DELETE,OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization")}function normalizePath(t=""){try{return new URL(t,"http://localhost").pathname.replace(/^\/api\/?/,"/")}catch{return t.replace(/^\/api\/?/,"/")}}export default async function handler(t,e){if(setCORS(e),"OPTIONS"===t.method)return e.statusCode=204,e.end();const s=t.method||"GET",n=normalizePath(t.url||"");try{return"/nightscout/save"===n&&"POST"===s?nsSave(t,e):"/nightscout/test"===n&&"POST"===s?nsTest(t,e):"/nightscout/sync"===n&&"POST"===s?nsSync(t,e):(e.statusCode=404,e.setHeader("Content-Type","application/json; charset=utf-8"),e.end(JSON.stringify({ok:!1,error:`Not found: ${s} ${n}`})))}catch(t){return e.statusCode=500,e.setHeader("Content-Type","application/json; charset=utf-8"),e.end(JSON.stringify({ok:!1,error:String(t?.message||t)}))}}